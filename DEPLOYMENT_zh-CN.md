# 部署与架构说明

本文件旨在说明“股票/ETF振幅查看器”的设计理念、架构，以及为什么它需要一个本地服务器来运行。

## 核心问题：浏览器的同源策略

现代网络浏览器有一个非常重要的安全机制，叫做 **“同源策略” (Same-Origin Policy)**。该策略规定，一个网页的脚本（例如，我们应用中的 `app.js`）只能请求来自同一“源”（协议、域名、端口号三者完全相同）的资源。

我们的前端页面 `app.html` 是通过 `file:///` 协议从您的本地文件系统加载的。而它需要获取的数据，例如来自新浪财经的股票数据，则位于 `https://finance.sina.com.cn` 这样的网络地址上。

对于浏览器来说，`file:///` 和 `https://finance.sina.com.cn` 是两个完全不同的源。因此，浏览器会出于安全考虑，阻止 `app.html` 中的脚本直接向新浪财经的服务器发送网络请求。这个限制被称为 **“跨域资源共享” (Cross-Origin Resource Sharing, CORS)** 问题。

## 解决方案：本地服务器作为代理

为了解决CORS问题，我们采用了一个经典的解决方案：**引入一个本地后端服务器作为中间代理**。

### 架构图

```
+-----------------+      /       +------------------------+
|   您的浏览器     |     /         |    新浪财经等远程服务器   |
| (运行 app.html) |    /          | (https://finance...)   |
+-----------------+   /            +------------------------+
        |            /|\                      |
        |             | (此路不通, 被CORS阻止) |
        |            \|/                      |
        |                                     |
        | 1. 向本地服务器发起请求             | 2. 本地服务器转发请求
        +------------------------------------>+
                                              |
+-----------------+      3. 返回数据给本地服务器      +------------------------+
|   本地Node.js服务器 |<------------------------------------+    (服务器之间无CORS限制)    |
| (localhost:3000)  |                                     |
+-----------------+      4. 返回数据给浏览器              |
        ^                                     |
        |                                     |
        +-------------------------------------+
```

### 工作流程

1.  **前端请求**: 当您在浏览器中点击“查询”时，前端的 JavaScript (`app.js`) 不再直接请求新浪财经。相反，它向我们自己的本地服务器 `http://localhost:3000/api/kline` 发送一个请求。
2.  **后端转发**: 本地服务器 (`server.js`) 接收到这个请求。由于服务器端的程序（如 Node.js）不受浏览器同源策略的限制，它可以自由地向任何外部API（如新浪财经）发送网络请求。
3.  **获取数据**: 本地服务器成功从新浪财经获取到股票数据。
4.  **返回数据**: 本地服务器将获取到的数据再回传给前端页面。因为前端页面和本地服务器同在 `localhost` 上（可以被视为同源），浏览器允许这次数据交换。

通过这种方式，本地服务器就像一个桥梁，优雅地绕过了浏览器的CORS限制，使得前端页面可以顺利地获取并展示外部数据。

## 组件角色

-   **`app.html`, `app.js`, `style.css` (前端)**
    -   **角色**: 用户界面 (UI)
    -   **职责**: 提供交互界面，接收用户输入（股票代码、日期），使用 ECharts 渲染K线图和振幅图，并将所有数据请求发送到本地后端。

-   **`server.js` (后端)**
    -   **角色**: 数据代理 (Proxy)
    -   **职责**: 监听来自前端的API请求，调用 `axios` 或 `node-fetch` 等库向真实的外部数据源（新浪财经）发起HTTP请求，处理返回的数据（包括解决可能的字符编码问题，如 `gbk` 转 `utf-8`），最后将干净的 JSON 数据返回给前端。

-   **`package.json`**
    -   **角色**: 项目清单
    -   **职责**: 定义项目信息、依赖库 (如 `express`, `axios`) 以及快捷命令 (如 `npm start`)。

希望这份文档能帮助您更好地理解本工具的工作原理。